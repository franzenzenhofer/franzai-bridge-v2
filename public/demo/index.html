<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FranzAI Bridge Demo - Live API Testing</title>
  <meta name="description" content="Test AI API calls with FranzAI Bridge. Requires the Chrome extension.">
  <link rel="icon" href="/favicon.ico">
  <style>
    /* DevTools Light Mode - Exact Match to Extension Sidepanel */
    :root {
      --bg: #ffffff;
      --panel: #f1f3f4;
      --panel-lighter: #e8eaed;
      --text: #202124;
      --text-bright: #000000;
      --muted: #5f6368;
      --border: #dadce0;
      --accent: #1a73e8;
      --success: #188038;
      --error: #d93025;
      --warning: #e37400;
      --method-get: #1a73e8;
      --method-post: #188038;
      --row-hover: #f1f3f4;
      --row-selected: #e8f0fe;
      --font-mono: "Roboto Mono", "SF Mono", "Monaco", "Consolas", monospace;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    html, body {
      background: var(--bg);
      color: var(--text);
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      font-size: 12px;
      height: 100%;
    }

    .topbar {
      display: flex;
      align-items: center;
      padding: 6px 10px;
      background: var(--panel);
      border-bottom: 1px solid var(--border);
      gap: 8px;
      min-height: 36px;
    }

    .brand { display: flex; align-items: baseline; gap: 6px; }
    .brand .title { font-weight: 600; font-size: 13px; color: var(--text-bright); }
    .brand .version { font-size: 10px; color: var(--muted); font-family: var(--font-mono); }

    .status-indicator {
      margin-left: auto;
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 4px;
      font-size: 11px;
    }

    .status-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--muted); }
    .status-dot.checking { background: var(--warning); animation: pulse 1s infinite; }
    .status-dot.ready { background: var(--success); }
    .status-dot.error { background: var(--error); }

    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

    .back-link { color: var(--muted); text-decoration: none; font-size: 11px; display: flex; align-items: center; gap: 4px; }
    .back-link:hover { color: var(--accent); }

    .toolbar {
      display: flex;
      align-items: center;
      padding: 4px 10px;
      background: var(--bg);
      border-bottom: 1px solid var(--border);
      gap: 8px;
      min-height: 32px;
    }

    .toolbar-title { font-weight: 600; font-size: 12px; color: var(--text); }

    .layout { display: flex; height: calc(100vh - 68px); }

    .input-panel {
      width: 400px;
      border-right: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      background: var(--bg);
    }

    .input-section { padding: 12px; border-bottom: 1px solid var(--border); }
    .input-section label { display: block; font-size: 11px; font-weight: 500; color: var(--muted); margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px; }
    .input-section select, .input-section textarea {
      width: 100%;
      padding: 8px;
      font-size: 12px;
      border: 1px solid var(--border);
      border-radius: 4px;
      background: var(--bg);
      color: var(--text);
      font-family: var(--font-mono);
    }
    .input-section select:focus, .input-section textarea:focus { outline: none; border-color: var(--accent); }
    .input-section textarea { min-height: 120px; resize: vertical; }

    .send-btn {
      width: 100%;
      padding: 10px;
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
    }
    .send-btn:hover { background: #1557b0; }
    .send-btn:disabled { background: var(--muted); cursor: not-allowed; }

    .output-panel { flex: 1; display: flex; flex-direction: column; overflow: hidden; }

    .table-header {
      display: grid;
      grid-template-columns: 60px 50px 1fr 50px 50px;
      background: var(--panel);
      border-bottom: 1px solid var(--border);
      font-size: 10px;
      color: var(--muted);
      font-weight: 500;
      text-transform: uppercase;
    }
    .table-header > div { padding: 6px 4px; border-right: 1px solid var(--border); }
    .table-header > div:last-child { border-right: none; }

    .log-list { flex: 0 0 auto; max-height: 200px; overflow: auto; border-bottom: 1px solid var(--border); }

    .log-item {
      display: grid;
      grid-template-columns: 60px 50px 1fr 50px 50px;
      border-bottom: 1px solid var(--border);
      cursor: pointer;
      font-family: var(--font-mono);
      font-size: 11px;
    }
    .log-item:hover { background: var(--row-hover); }
    .log-item.active { background: var(--row-selected); border-left: 2px solid var(--accent); }
    .log-item > div { padding: 5px 4px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .log-item .method { font-weight: 600; font-size: 10px; }
    .log-item .method.POST { color: var(--method-post); }
    .log-item .status.success { color: var(--success); }
    .log-item .status.error { color: var(--error); }
    .log-item .time { color: var(--muted); font-size: 10px; }
    .log-item .elapsed { color: var(--muted); text-align: right; }

    .detail-panel { flex: 1; overflow: auto; font-family: var(--font-mono); font-size: 11px; }
    .detail-section { border-bottom: 1px solid var(--border); }
    .section-header { padding: 8px; background: var(--panel); }
    .section-title { font-weight: 600; font-size: 11px; color: var(--text); text-transform: uppercase; }
    .detail-section pre { margin: 0; padding: 8px; white-space: pre-wrap; word-break: break-word; max-height: 200px; overflow: auto; }

    .empty-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      color: var(--muted);
      gap: 16px;
      padding: 40px;
      text-align: center;
    }
    .empty-state svg { width: 64px; height: 64px; opacity: 0.3; }
    .empty-state h3 { font-size: 16px; font-weight: 600; color: var(--text); }
    .empty-state p { font-size: 13px; max-width: 300px; }

    .install-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 20px;
      background: var(--accent);
      color: white;
      text-decoration: none;
      border-radius: 4px;
      font-size: 13px;
      font-weight: 500;
    }
    .install-btn:hover { background: #1557b0; }

    .hint { color: var(--muted); padding: 20px; text-align: center; font-size: 12px; }

    @media (max-width: 768px) {
      .layout { flex-direction: column; }
      .input-panel { width: 100%; border-right: none; border-bottom: 1px solid var(--border); }
    }
  </style>
</head>
<body>
  <header class="topbar">
    <a href="/" class="back-link">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>
      Back
    </a>
    <div class="brand">
      <span class="title">FranzAI Bridge Demo</span>
      <span class="version">v2.0</span>
    </div>
    <div class="status-indicator" id="statusIndicator">
      <span class="status-dot checking" id="statusDot"></span>
      <span id="statusText">Checking...</span>
    </div>
  </header>

  <nav class="toolbar">
    <span class="toolbar-title">Live API Testing</span>
  </nav>

  <main class="layout" id="mainContent"></main>

  <script>
    let extensionReady = false;
    let logs = [];
    let selectedLogIndex = -1;

    const mainContent = document.getElementById('mainContent');
    const statusDot = document.getElementById('statusDot');
    const statusText = document.getElementById('statusText');

    async function checkExtension() {
      try {
        if (window.franzai && typeof window.franzai.ping === 'function') {
          const result = await window.franzai.ping();
          if (result && result.ok) {
            extensionReady = true;
            statusDot.className = 'status-dot ready';
            statusText.textContent = 'Ready (v' + result.version + ')';
            renderDemoUI();
            return;
          }
        }
      } catch (e) { /* ignore */ }

      extensionReady = false;
      statusDot.className = 'status-dot error';
      statusText.textContent = 'Extension required';
      renderInstallPrompt();
    }

    function renderInstallPrompt() {
      mainContent.textContent = '';
      const container = document.createElement('div');
      container.className = 'empty-state';

      const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
      svg.setAttribute('viewBox', '0 0 24 24');
      svg.setAttribute('fill', 'none');
      svg.setAttribute('stroke', 'currentColor');
      svg.setAttribute('stroke-width', '1.5');
      svg.innerHTML = '<rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/>';

      const h3 = document.createElement('h3');
      h3.textContent = 'Extension Required';

      const p = document.createElement('p');
      p.textContent = 'The FranzAI Bridge Chrome extension must be installed to use this demo.';

      const a = document.createElement('a');
      a.href = '/';
      a.className = 'install-btn';
      a.textContent = 'Get the Extension';

      container.appendChild(svg);
      container.appendChild(h3);
      container.appendChild(p);
      container.appendChild(a);
      mainContent.appendChild(container);
    }

    function renderDemoUI() {
      mainContent.textContent = '';

      // Input panel
      const inputPanel = document.createElement('div');
      inputPanel.className = 'input-panel';

      // Provider section
      const providerSection = document.createElement('div');
      providerSection.className = 'input-section';
      const providerLabel = document.createElement('label');
      providerLabel.textContent = 'Provider';
      const providerSelect = document.createElement('select');
      providerSelect.id = 'provider';
      [
        ['openai', 'OpenAI (gpt-4o-mini)'],
        ['anthropic', 'Anthropic (claude-sonnet-4)'],
        ['gemini', 'Google Gemini (gemini-2.0-flash-lite)'],
        ['mistral', 'Mistral (mistral-small-latest)']
      ].forEach(([value, text]) => {
        const opt = document.createElement('option');
        opt.value = value;
        opt.textContent = text;
        providerSelect.appendChild(opt);
      });
      providerSection.appendChild(providerLabel);
      providerSection.appendChild(providerSelect);

      // Prompt section
      const promptSection = document.createElement('div');
      promptSection.className = 'input-section';
      const promptLabel = document.createElement('label');
      promptLabel.textContent = 'Prompt';
      const promptTextarea = document.createElement('textarea');
      promptTextarea.id = 'prompt';
      promptTextarea.placeholder = 'Enter your prompt here...';
      promptTextarea.value = 'Hello! Tell me a fun fact about AI.';
      promptSection.appendChild(promptLabel);
      promptSection.appendChild(promptTextarea);

      // Send button section
      const btnSection = document.createElement('div');
      btnSection.className = 'input-section';
      const sendBtn = document.createElement('button');
      sendBtn.className = 'send-btn';
      sendBtn.id = 'sendBtn';
      sendBtn.textContent = 'Send Request';
      sendBtn.onclick = sendRequest;
      btnSection.appendChild(sendBtn);

      inputPanel.appendChild(providerSection);
      inputPanel.appendChild(promptSection);
      inputPanel.appendChild(btnSection);

      // Output panel
      const outputPanel = document.createElement('div');
      outputPanel.className = 'output-panel';

      const tableHeader = document.createElement('div');
      tableHeader.className = 'table-header';
      ['Time', 'Method', 'URL', 'Status', 'ms'].forEach(text => {
        const div = document.createElement('div');
        div.textContent = text;
        tableHeader.appendChild(div);
      });

      const logList = document.createElement('div');
      logList.className = 'log-list';
      logList.id = 'logList';
      const hint = document.createElement('div');
      hint.className = 'hint';
      hint.textContent = 'Make a request to see it here';
      logList.appendChild(hint);

      const detailPanel = document.createElement('div');
      detailPanel.className = 'detail-panel';
      detailPanel.id = 'detailPanel';
      const detailHint = document.createElement('div');
      detailHint.className = 'hint';
      detailHint.textContent = 'Select a request to view details';
      detailPanel.appendChild(detailHint);

      outputPanel.appendChild(tableHeader);
      outputPanel.appendChild(logList);
      outputPanel.appendChild(detailPanel);

      mainContent.appendChild(inputPanel);
      mainContent.appendChild(outputPanel);
    }

    function getProviderConfig(provider) {
      const configs = {
        openai: { url: 'https://api.openai.com/v1/chat/completions', body: (p) => ({ model: 'gpt-4o-mini', messages: [{ role: 'user', content: p }] }) },
        anthropic: { url: 'https://api.anthropic.com/v1/messages', headers: { 'anthropic-version': '2023-06-01' }, body: (p) => ({ model: 'claude-sonnet-4-20250514', max_tokens: 1024, messages: [{ role: 'user', content: p }] }) },
        gemini: { url: 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-lite:generateContent', body: (p) => ({ contents: [{ parts: [{ text: p }] }] }) },
        mistral: { url: 'https://api.mistral.ai/v1/chat/completions', body: (p) => ({ model: 'mistral-small-latest', messages: [{ role: 'user', content: p }] }) }
      };
      return configs[provider];
    }

    async function sendRequest() {
      if (!extensionReady) return;

      const provider = document.getElementById('provider').value;
      const prompt = document.getElementById('prompt').value.trim();
      const sendBtn = document.getElementById('sendBtn');

      if (!prompt) { alert('Please enter a prompt'); return; }

      const config = getProviderConfig(provider);
      const startTime = Date.now();

      const logEntry = {
        id: Date.now(),
        time: new Date().toLocaleTimeString(),
        method: 'POST',
        url: config.url,
        status: null,
        elapsed: null,
        request: { headers: { 'Content-Type': 'application/json', ...(config.headers || {}) }, body: config.body(prompt) },
        response: null,
        error: null
      };

      logs.unshift(logEntry);
      renderLogs();
      selectLog(0);

      sendBtn.disabled = true;
      sendBtn.textContent = 'Sending...';

      try {
        const response = await fetch(config.url, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', ...(config.headers || {}) },
          body: JSON.stringify(config.body(prompt))
        });

        logEntry.elapsed = Date.now() - startTime;
        logEntry.status = response.status;
        logEntry.response = { status: response.status, statusText: response.statusText, body: await response.json() };
      } catch (e) {
        logEntry.elapsed = Date.now() - startTime;
        logEntry.status = 'ERR';
        logEntry.error = e.message;
      }

      renderLogs();
      renderDetail(logEntry);
      sendBtn.disabled = false;
      sendBtn.textContent = 'Send Request';
    }

    function renderLogs() {
      const logList = document.getElementById('logList');
      if (!logList) return;
      logList.textContent = '';

      if (logs.length === 0) {
        const hint = document.createElement('div');
        hint.className = 'hint';
        hint.textContent = 'Make a request to see it here';
        logList.appendChild(hint);
        return;
      }

      logs.forEach((log, i) => {
        const item = document.createElement('div');
        item.className = 'log-item' + (i === selectedLogIndex ? ' active' : '');
        item.onclick = () => selectLog(i);

        const timeDiv = document.createElement('div');
        timeDiv.className = 'time';
        timeDiv.textContent = log.time;

        const methodDiv = document.createElement('div');
        methodDiv.className = 'method ' + log.method;
        methodDiv.textContent = log.method;

        const urlDiv = document.createElement('div');
        urlDiv.className = 'url';
        urlDiv.textContent = new URL(log.url).pathname;

        const statusDiv = document.createElement('div');
        statusDiv.className = 'status ' + (log.status >= 200 && log.status < 300 ? 'success' : 'error');
        statusDiv.textContent = log.status || '...';

        const elapsedDiv = document.createElement('div');
        elapsedDiv.className = 'elapsed';
        elapsedDiv.textContent = log.elapsed !== null ? log.elapsed : '...';

        item.appendChild(timeDiv);
        item.appendChild(methodDiv);
        item.appendChild(urlDiv);
        item.appendChild(statusDiv);
        item.appendChild(elapsedDiv);
        logList.appendChild(item);
      });
    }

    function selectLog(index) {
      selectedLogIndex = index;
      renderLogs();
      renderDetail(logs[index]);
    }

    function renderDetail(log) {
      const detailPanel = document.getElementById('detailPanel');
      if (!detailPanel) return;
      detailPanel.textContent = '';

      if (!log) {
        const hint = document.createElement('div');
        hint.className = 'hint';
        hint.textContent = 'Select a request to view details';
        detailPanel.appendChild(hint);
        return;
      }

      // Request section
      const reqSection = document.createElement('div');
      reqSection.className = 'detail-section';
      const reqHeader = document.createElement('div');
      reqHeader.className = 'section-header';
      const reqTitle = document.createElement('span');
      reqTitle.className = 'section-title';
      reqTitle.textContent = 'Request';
      reqHeader.appendChild(reqTitle);
      const reqPre = document.createElement('pre');
      reqPre.textContent = JSON.stringify(log.request, null, 2);
      reqSection.appendChild(reqHeader);
      reqSection.appendChild(reqPre);
      detailPanel.appendChild(reqSection);

      // Response section
      if (log.response) {
        const resSection = document.createElement('div');
        resSection.className = 'detail-section';
        const resHeader = document.createElement('div');
        resHeader.className = 'section-header';
        const resTitle = document.createElement('span');
        resTitle.className = 'section-title';
        resTitle.textContent = 'Response (' + log.response.status + ' ' + log.response.statusText + ')';
        resHeader.appendChild(resTitle);
        const resPre = document.createElement('pre');
        resPre.textContent = JSON.stringify(log.response.body, null, 2);
        resSection.appendChild(resHeader);
        resSection.appendChild(resPre);
        detailPanel.appendChild(resSection);
      }

      // Error section
      if (log.error) {
        const errSection = document.createElement('div');
        errSection.className = 'detail-section';
        const errHeader = document.createElement('div');
        errHeader.className = 'section-header';
        const errTitle = document.createElement('span');
        errTitle.className = 'section-title';
        errTitle.style.color = 'var(--error)';
        errTitle.textContent = 'Error';
        errHeader.appendChild(errTitle);
        const errPre = document.createElement('pre');
        errPre.style.color = 'var(--error)';
        errPre.textContent = log.error;
        errSection.appendChild(errHeader);
        errSection.appendChild(errPre);
        detailPanel.appendChild(errSection);
      }
    }

    setTimeout(checkExtension, 300);
  </script>
</body>
</html>
